<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cadastrar Usuário - Sistema Inteligente de Chamados</title>
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/index.css">
  </head>
  <body>
    <div class="wrap">
      <div class="card" style="max-width:640px; width:100%; padding:22px">
        <div>
          <div class="brand">
            <div class="logo">SI</div>
            <div>
              <h1>Cadastrar novo usuário</h1>
              <div class="meta">Preencha os dados abaixo para criar uma conta (protótipo)</div>
            </div>
          </div>

          <p class="lead">Informe nome, email, senha e papel (Usuário ou Analista).</p>

          <div class="login-card">
            <form id="registerForm">
              <label for="name">Nome</label>
              <input id="name" name="name" type="text" required />

              <label for="email">Email</label>
              <input id="email" name="email" type="email" required />

              <label for="password">Senha</label>
              <input id="password" name="password" type="password" minlength="6" required />

              <label for="confirm">Confirmar senha</label>
              <input id="confirm" name="confirm" type="password" minlength="6" required />

              <label for="role">Papel</label>
              <div style="display:flex; gap:8px; margin-top:6px">
                <button type="button" id="roleUser" class="tab active">Usuário</button>
                <button type="button" id="roleAnalyst" class="tab">Analista</button>
              </div>

              <div id="regError" style="color:#c00; margin-top:8px; display:none"></div>

              <div style="display:flex; gap:8px; margin-top:12px">
                <button type="submit" class="btn-large" style="flex:1">Cadastrar</button>
                <a href="index.html" class="btn-ghost" style="display:inline-flex;align-items:center;gap:8px">Voltar</a>
              </div>
            </form>
          </div>

        </div>
      </div>
    </div>

    <script>
      (function(){
        const $ = id => document.getElementById(id);
        const roleUser = $('roleUser');
        const roleAnalyst = $('roleAnalyst');
        const form = $('registerForm');
        const errorBox = $('regError');

        function setRole(role){
          if(role === 'analista'){
            roleAnalyst.classList.add('active');
            roleUser.classList.remove('active');
          } else {
            roleUser.classList.add('active');
            roleAnalyst.classList.remove('active');
          }
        }
        roleUser && roleUser.addEventListener('click', () => setRole('usuario'));
        roleAnalyst && roleAnalyst.addEventListener('click', () => setRole('analista'));

        form && form.addEventListener('submit', function(ev){
          ev.preventDefault();
          if(errorBox) errorBox.style.display = 'none';

          const name = ($('name') && $('name').value || '').trim();
          const email = ($('email') && $('email').value || '').trim().toLowerCase();
          const password = ($('password') && $('password').value || '').trim();
          const confirm = ($('confirm') && $('confirm').value || '').trim();
          const role = roleAnalyst && roleAnalyst.classList.contains('active') ? 'analista' : 'usuario';

          if(!name || !email || !password){
            if(errorBox){ errorBox.textContent = 'Preencha todos os campos obrigatórios.'; errorBox.style.display = 'block'; }
            return;
          }
          if(password.length < 6){ if(errorBox){ errorBox.textContent = 'A senha deve ter ao menos 6 caracteres.'; errorBox.style.display = 'block'; } return; }
          if(password !== confirm){ if(errorBox){ errorBox.textContent = 'As senhas não coincidem.'; errorBox.style.display = 'block'; } return; }

          // For prototype: save a minimal user (no real auth)
          const user = { name: name, email: email, role: role };
          try{
            // store under a simple key to simulate registration list
            const listRaw = localStorage.getItem('registeredUsers');
            const list = listRaw ? JSON.parse(listRaw) : [];
            list.push({ name: name, email: email, password: password, role: role });
            localStorage.setItem('registeredUsers', JSON.stringify(list));
            // Also set as current user (demo)
            localStorage.setItem('currentUser', JSON.stringify(user));
          }catch(e){ console.warn('localStorage failed', e); }

          // redirect based on role
          if(role === 'analista') window.location = 'Analista/analista.html';
          else window.location = 'Usuario/usuario.html';
        });
      })();
    </script>
  </body>
</html>
